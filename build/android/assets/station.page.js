var Moment=require("vendor/moment");Moment.locale("de"),module.exports=function(t){var e=Ti.UI.createView({backgroundColor:"#fff",date:Moment().startOf("day"),itemId:{name:t.name,podcasts:t.podcasts,live:t.live,stream:t.stream}}),o=Ti.UI.createView({width:200,right:-200,opacity:.9,top:0,height:40,color:"white",text:"Heute",zIndex:999,transform:Ti.UI.create2DMatrix({rotate:90,anchorPoint:{x:0,y:0}}),backgroundColor:t.color,font:{fontSize:20,fontFamily:"ScalaSansBold"}});o.add(Ti.UI.createLabel({text:"Heute",left:15,width:Ti.UI.FILL,color:"white",touchEnabled:!1,font:{fontSize:22,fontFamily:"ScalaSansBold"}})),o.addEventListener("click",function(){var t=Ti.UI.createPicker({type:Ti.UI.PICKER_TYPE_DATE,minDate:new Date(2009,0,1),maxDate:Moment().toDate(),value:e.date.toDate(),locale:"de"});t.showDatePickerDialog({value:e.date.toDate(),callback:function(t){t.cancel||(e.date=Moment(t.value).startOf("day"),o.children[0].setText(Moment(e.date).format("LL")),e.updatePodcasts())}})}),o.addEventListener("swipe",function(t){"left"==t.direction&&(e.date=e.date.add(-1,"d"),e.hideCurrent()),"right"==t.direction&&e.date.isBefore(Moment().startOf("day"))&&(e.date=e.date.add(1,"d")),t.source.children[0].setText(Moment(e.date).format("LL")),e.updatePodcasts()}),e.containerforcurrenttext=Ti.UI.createScrollView({top:-200,scrollType:"vertical",contentHeight:Ti.UI.SIZE,backgroundColor:"#444",layout:"vertical",height:200}),setTimeout(function(){e.add(o)},5e3),e.add(e.containerforcurrenttext),e.add(Ti.UI.createView({top:0,height:7,backgroundColor:t.color})),e.list=Ti.UI.createListView({top:7,height:Ti.UI.FILL,backgroundColor:t.color,templates:{podcast:require("TEMPLATES").podcast},defaultItemTemplate:"podcast",sections:[Ti.UI.createListSection({})]}),e.add(e.list);var a=[],r="";return e.showCurrent=function(){e.list.animate({top:200,duration:700}),e.containerforcurrenttext.setTop(0),require("controls/rpc.adapter")({url:t.live,nocache:!0,onload:function(o){if(r!=o.hash){r=o.hash;var a=o.payload;e.containerforcurrenttext.top=0,e.containerforcurrenttext.removeAllChildren(),e.containerforcurrenttext.add(Ti.UI.createLabel({right:50,top:8,color:"#eee",font:{fontSize:16,fontFamily:"ScalaSans"},text:"seit: "+a.time_start})),e.containerforcurrenttext.add(Ti.UI.createLabel({left:10,top:-5,text:a.name,color:t.color,font:{fontSize:20,fontFamily:"ScalaSansBold"},right:50})),"string"==typeof a.text&&e.containerforcurrenttext.add(Ti.UI.createLabel({left:10,right:50,top:0,bottom:100,text:a.text.substr(a.name.length).trim(),font:{fontSize:14,fontFamily:"ScalaSans"},color:"#eee"}))}}})},e.hideCurrent=function(){e.list.setTop(0),e.containerforcurrenttext.setTop(-200)},e.updatePodcasts=function(){require("controls/rpc.adapter")({url:t.podcasts,nocache:e.date.isSame(Moment().startOf("day"))?!0:!1,date:e.date.format("DD.MM.YYYY"),onload:function(o){a=[],o.payload.item.forEach(function(e){console.log(e);var o=e.author;o="string"==typeof o?o.split(", ")[1]+" "+o.split(", ")[0]:o.text,a.push({properties:{accessoryType:Ti.UI.LIST_ACCESSORY_TYPE_DISCLOSURE,itemId:JSON.stringify(e)},start:{text:e.datetime.split(" ")[1].substr(0,5)},title:{color:t.color,text:e.sendung.text},subtitle:{text:e.title||""},autor:{text:void 0!=o?"Autor: "+o:""}})}),e.list.sections[0].setItems(a),e.list.setSections([e.list.sections[0]]),e.date.isSame(Moment().startOf("day"))&&e.showCurrent()}})},e.updatePodcasts(),e.date.isSame(Moment().startOf("day"))?e.cron=setInterval(e.updatePodcasts,6e4):clearInterval(e.cron),e.list.addEventListener("itemclick",function(t){console.log(JSON.parse(t.itemId)),Ti.App.fireEvent("app:play",{item:JSON.parse(t.itemId)})}),e};